!function(){var e;function o(e,r){var n,t={}.hasOwnProperty;for(n in r)t.call(r,n)&&(e[n]=r[n]);return e}(e=function(e){return null==e&&(e={}),this.inited=!1,this._init=[],this.worker=null,this.queue={main:null,list:[]},this.evtHandler={},this.workerUrl=e.worker||"/assets/lib/@plotdb/h264.mp4/main/worker.js",this.canvas=document.createElement("canvas"),this}).prototype=o(Object.create(Object.prototype),{encoding:function(t){var i=this,u=t.name;return console.log(u),new Promise(function(e,r){var n=new FileReader;return n.onload=function(){return e({name:u,data:new Uint8Array(n.result)})},n.readAsArrayBuffer(t)}).then(function(e){var n={arguments:["-i",u+""],MEMFS:[e],TOTAL_MEMORY:4294967296};return(i.queue.main?new Promise(function(e,r){return i.queue.list.push({res:e,rej:r})}):Promise.resolve()).then(function(){return new Promise(function(e,r){return i.queue.main={res:e,rej:r},i.worker.postMessage(o({type:"run"},n))})})})},on:function(e,n){var t=this;return(Array.isArray(e)?e:[e]).map(function(e){var r;return((r=t.evtHandler)[e]||(r[e]=[])).push(n)})},fire:function(e){for(var r,n,t,i,u=[],o=[],s=1,a=arguments.length;s<a;++s)o.push(arguments[s]);for(r=o,s=0,t=(n=this.evtHandler[e]||[]).length;s<t;++s)i=n[s],u.push(i.apply(this,r));return u},init:function(){var u=this;return new Promise(function(i,e){return u.inited?i():(u.worker&&u._init.push({res:i,rej:e}),u.worker=new Worker(u.workerUrl),u.worker.onmessage=function(e){var r,n,t=e.data;switch(console.log(t),t.type){case"ready":return u.inited=!0,i(),u._init.splice(0).map(function(e){return e.res()});case"stderr":if(!u.queue.main||!/\s*Stream/.exec(t.data))return;if(!(r=/Video:\s*(\S+)/.exec(t.data))||"h264"!==r[1])return;if(u.queue.main.res("h264"),u.queue.main=null,n=u.queue.list.splice(0,1)[0])return n.res("h264");break;case"done":return u.queue.main?((n=new Error).name="lderror",n.id=1020,n=n,u.queue.main.rej(n),u.queue.main=null,(r=u.queue.list.splice(0,1)[0])?r.rej(n):void 0):void 0}})})}}),"undefined"!=typeof module&&null!==module?module.exports=e:"undefined"!=typeof window&&null!==window&&(window.ffmpeg=e)}.call(this);
